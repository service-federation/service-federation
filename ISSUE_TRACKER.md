| ID       | Status  | Priority | Complexity | Description |
|----------|---------|----------|------------|-------------|
| SF-00144 | Done | MEDIUM | High medium | Structural improvements for service registration and port storage — (1) `RegistrationOutcome` enum replacing opaque bool from `register_service`. (2) `ServiceRegistration` RAII scope guard with commit pattern, eliminating manual unregister paths. (3) `PortStore` trait unifying session and SQLite port caches behind one interface, collapsing the 200-line resolver port resolution block into two focused helpers. |
| SF-00145 | Done | HIGH | High | Extract `DockerClient` from shell-out calls — Created `DockerClient` struct in `src/docker/client.rs` encapsulating all `docker` CLI interactions. All `Command::new("docker")` sites migrated except compose detection and docker build (deliberate exceptions). Consistent timeout handling and error mapping through single `run()` helper. |
| SF-00146 | Pending | MEDIUM | High medium | Decouple extracted orchestrator modules from `&Orchestrator` — `ScriptRunner`, `OrphanCleaner`, `HealthCheckRunner` currently hold `&Orchestrator` and reach into its fields. Refactor each to accept only the specific dependencies it needs (config, state tracker handle, service map) as constructor args. Enables unit testing without constructing a full Orchestrator. |
| SF-00147 | Done | MEDIUM | Low medium | Structure `Docker(String)` error variant — Replaced `Docker(String)` with `Docker(#[from] DockerError)` in `src/docker/error.rs`. Five variants: `Timeout`, `CommandFailed`, `ExecFailed`, `ContainerNotFound`, `DaemonUnavailable`. `suggestion()` gives variant-specific hints. |
| SF-00148 | Pending | LOW | Low medium | Audit `parking_lot` vs `tokio` lock usage — Grep for all `parking_lot::RwLock` and `parking_lot::Mutex` usages. Verify none are held across `.await` points. If any are, migrate to `tokio::sync` equivalents. If none are, add a doc comment explaining the intentional split. |
| SF-00149 | Pending | LOW | Low | Resolve `parameters` vs `variables` config duality — `get_effective_parameters()` silently prefers `variables` over `parameters`. Either: (a) emit a deprecation warning when `parameters` is used and migrate to `variables`, or (b) unify into a single field with a serde alias. Reject configs that set both. |
| SF-00150 | Pending | LOW | Low | Load `Session` once at init instead of per-access — `Session::current_for_workdir()` reads and parses `ports.json` from disk on every call. Load the session once during orchestrator initialization and thread the instance through, avoiding repeated filesystem access during port resolution. |
