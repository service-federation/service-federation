| ID       | Status  | Priority | Complexity | Description |
|----------|---------|----------|------------|-------------|
| SF-00144 | Done | MEDIUM | High medium | Structural improvements for service registration and port storage — (1) `RegistrationOutcome` enum replacing opaque bool from `register_service`. (2) `ServiceRegistration` RAII scope guard with commit pattern, eliminating manual unregister paths. (3) `PortStore` trait unifying session and SQLite port caches behind one interface, collapsing the 200-line resolver port resolution block into two focused helpers. |
| SF-00145 | Done | HIGH | High | Extract `DockerClient` from shell-out calls — Created `DockerClient` struct in `src/docker/client.rs` encapsulating all `docker` CLI interactions. All `Command::new("docker")` sites migrated except compose detection and docker build (deliberate exceptions). Consistent timeout handling and error mapping through single `run()` helper. |
| SF-00146 | Pending | MEDIUM | High medium | Decouple extracted orchestrator modules from `&Orchestrator` — `ScriptRunner`, `OrphanCleaner`, `HealthCheckRunner` currently hold `&Orchestrator` and reach into its fields. Refactor each to accept only the specific dependencies it needs (config, state tracker handle, service map) as constructor args. Enables unit testing without constructing a full Orchestrator. |
| SF-00147 | Done | MEDIUM | Low medium | Structure `Docker(String)` error variant — Replaced `Docker(String)` with `Docker(#[from] DockerError)` in `src/docker/error.rs`. Five variants: `Timeout`, `CommandFailed`, `ExecFailed`, `ContainerNotFound`, `DaemonUnavailable`. `suggestion()` gives variant-specific hints. |
| SF-00148 | Pending | LOW | Low medium | Audit `parking_lot` vs `tokio` lock usage — Grep for all `parking_lot::RwLock` and `parking_lot::Mutex` usages. Verify none are held across `.await` points. If any are, migrate to `tokio::sync` equivalents. If none are, add a doc comment explaining the intentional split. |
| SF-00149 | Pending | LOW | Low | Resolve `parameters` vs `variables` config duality — `get_effective_parameters()` silently prefers `variables` over `parameters`. Either: (a) emit a deprecation warning when `parameters` is used and migrate to `variables`, or (b) unify into a single field with a serde alias. Reject configs that set both. |
| SF-00150 | Pending | LOW | Low | Load `Session` once at init instead of per-access — `Session::current_for_workdir()` reads and parses `ports.json` from disk on every call. Load the session once during orchestrator initialization and thread the instance through, avoiding repeated filesystem access during port resolution. |
| SF-00151 | Done | MEDIUM | Low | Dead `Error::PortConflict` variant — Removed. Was defined but never constructed anywhere. `DockerPortConflict` is the only port conflict error used. |
| SF-00152 | Done | MEDIUM | Low | Reject services with multiple type-defining fields — Added validation in `Config::validate()` that rejects services with more than one of: process, image, gradle_task, compose_file+compose_service. Shows which fields conflict. |
| SF-00153 | Done | MEDIUM | Low | Validate parameter defaults against `either` constraints — Added validation in `Config::validate()` checking parameter defaults satisfy their own `either` constraint at parse time instead of failing late during resolution. |
| SF-00154 | Pending | MEDIUM | Low medium | Port parameter `default` ignored when standard port is available — `type: port` with a non-standard `default` (e.g. 54829) resolves to the well-known port (5432) instead. `--randomize` respects the default but shouldn't be required. See [issue-docs/SF-00154-port-default-ignored.md](issue-docs/SF-00154-port-default-ignored.md). |
| SF-00155 | Done | HIGH | Medium | `isolated: true` reuses running containers instead of starting fresh ones — Fixed by adding `isolation_id` to Orchestrator. Child orchestrators now get a unique random ID (`iso-{:08x}`) that flows through to Docker container naming, healthcheck resolution, and volume scoping. See [issue-docs/SF-00155-isolated-reuses-containers.md](issue-docs/SF-00155-isolated-reuses-containers.md). |
| SF-00156 | Pending | MEDIUM | Low | Flaky test `error::tests::mismatched_start_time_returns_false` — panics with 'Current process PID with old timestamp should detect PID reuse'. Likely a timing issue in the PID reuse detection logic. |
